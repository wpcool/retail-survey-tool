<!-- è°ƒç ”è®°å½•åˆ—è¡¨é¡µ -->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <view class="page-title">ğŸ“ æˆ‘çš„è°ƒç ”è®°å½•</view>
    <view class="record-count" wx:if="{{records.length > 0}}">å…± {{records.length}} æ¡</view>
  </view>

  <!-- æ—¥æœŸç­›é€‰ -->
  <view class="filter-bar">
    <view class="filter-item">
      <text class="filter-label">ğŸ“… æ—¥æœŸ</text>
      <picker mode="date" value="{{filterDate}}" bindchange="onDateChange">
        <view class="filter-value {{filterDate ? '' : 'placeholder'}}">
          {{filterDate || 'é€‰æ‹©æ—¥æœŸ'}}
        </view>
      </picker>
      <text class="clear-btn" wx:if="{{filterDate}}" bindtap="clearDate">âœ•</text>
    </view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading" wx:if="{{loading && records.length === 0}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && records.length === 0}}">
    <text class="empty-icon">ğŸ“­</text>
    <text class="empty-title">æš‚æ— è®°å½•</text>
    <text class="empty-desc">{{filterDate ? 'è¯¥æ—¥æœŸæ²¡æœ‰è°ƒç ”è®°å½•' : 'å¿«å»åˆ›å»ºç¬¬ä¸€æ¡è°ƒç ”è®°å½•å§'}}</text>
  </view>

  <!-- è®°å½•åˆ—è¡¨ -->
  <view class="records-list" wx:if="{{records.length > 0}}">
    <view 
      class="record-card" 
      wx:for="{{records}}" 
      wx:key="id"
    >
      <!-- å¡ç‰‡å¤´éƒ¨ -->
      <view class="record-header">
        <view class="product-info">
          <text class="category-tag">{{item.category}}</text>
          <text class="product-name">{{item.product_name}}</text>
        </view>
        <text class="record-price">Â¥{{item.price}}</text>
      </view>

      <!-- å¡ç‰‡å†…å®¹ -->
      <view class="record-body">
        <view class="info-row">
          <text class="info-icon">ğŸª</text>
          <text class="info-text">{{item.store_name}}</text>
        </view>
        <view class="info-row" wx:if="{{item.store_address}}">
          <text class="info-icon">ğŸ“</text>
          <text class="info-text">{{item.store_address}}</text>
        </view>
        <view class="info-row" wx:if="{{item.promotion_info}}">
          <text class="info-icon">ğŸ·ï¸</text>
          <text class="info-text promo">{{item.promotion_info}}</text>
        </view>
        <view class="info-row" wx:if="{{item.remark}}">
          <text class="info-icon">ğŸ’¬</text>
          <text class="info-text">{{item.remark}}</text>
        </view>
      </view>

      <!-- å¡ç‰‡åº•éƒ¨ -->
      <view class="record-footer">
        <view class="record-time">
          <text class="date-tag {{item.isToday ? 'today' : ''}}">{{item.isToday ? 'ä»Šå¤©' : item.created_at.slice(0, 10)}}</text>
          <text class="time-text">{{item.created_at.slice(11, 16)}}</text>
        </view>
        <view class="action-btns">
          <!-- å½“å¤©è®°å½•å¯ä»¥ç¼–è¾‘å’Œåˆ é™¤ -->
          <block wx:if="{{item.canEdit}}">
            <button 
              class="btn-edit" 
              size="mini" 
              bindtap="editRecord"
              data-id="{{item.id}}"
            >ç¼–è¾‘</button>
            <button 
              class="btn-delete" 
              size="mini" 
              bindtap="deleteRecord"
              data-id="{{item.id}}"
            >åˆ é™¤</button>
          </block>
          <!-- éå½“å¤©è®°å½•åªèƒ½æŸ¥çœ‹ -->
          <block wx:else>
            <button 
              class="btn-view" 
              size="mini" 
              bindtap="viewRecord"
              data-id="{{item.id}}"
            >æŸ¥çœ‹</button>
          </block>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{records.length > 0 && hasMore}}" bindtap="loadMore">
    <text wx:if="{{!loading}}">ç‚¹å‡»åŠ è½½æ›´å¤š</text>
    <text wx:if="{{loading}}">åŠ è½½ä¸­...</text>
  </view>
  
  <view class="no-more" wx:if="{{records.length > 0 && !hasMore}}">
    <text>æ²¡æœ‰æ›´å¤šäº†</text>
  </view>
</view>